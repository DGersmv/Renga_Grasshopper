<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0-windows</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <PlatformTarget>x64</PlatformTarget>
    <Platforms>x64</Platforms>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>
    <AppendPlatformToOutputPath>false</AppendPlatformToOutputPath>
    <OutputPath>..\bin\$(Configuration)\$(AssemblyName)\</OutputPath>
    <RootNamespace>RengaPlugin</RootNamespace>
    <AssemblyName>RengaGH</AssemblyName>
    <ProjectGuid>{F1A2B3C4-D5E6-7890-FABC-DEF123456789}</ProjectGuid>
    <UseWindowsForms>true</UseWindowsForms>
    <Nullable>disable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <None Remove="RengaInterop.dll" />
  </ItemGroup>
  
  <ItemGroup>
    <None Include="RengaGH.rndesc">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="RengaGHIcon.png">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  
    <ItemGroup>
      <Reference Include="Renga.NET8.PluginUtility">
        <HintPath>C:\Program Files\Renga Standard\RengaSDK\Net\Renga.NET8.PluginUtility.dll</HintPath>
      </Reference>
      <Reference Include="Interop.Renga">
        <HintPath>C:\Program Files\Renga Standard\RengaSDK\Samples\C#\ObjectCreation\obj\Release\Interop.Renga.dll</HintPath>
        <Private>True</Private>
      </Reference>
      <COMFileReference Include="..\..\..\tlb\RengaCOMAPI.tlb">
        <EmbedInteropTypes>false</EmbedInteropTypes>
      </COMFileReference>
      <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
    </ItemGroup>

  <!-- Post-build event to copy to Renga plugins folder -->
  <Target Name="PostBuild" AfterTargets="Build">
    <PropertyGroup>
      <RengaPluginsPath>C:\Program Files\Renga Standard\Plugins\$(TargetName)</RengaPluginsPath>
    </PropertyGroup>
    <MakeDir Directories="$(RengaPluginsPath)" Condition="!Exists('$(RengaPluginsPath)')" />
    <Copy SourceFiles="$(TargetPath)" DestinationFolder="$(RengaPluginsPath)" ContinueOnError="true">
      <Output TaskParameter="CopiedFiles" ItemName="CopiedFiles" />
    </Copy>
    <Copy SourceFiles="$(TargetDir)$(TargetName).rndesc" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)$(TargetName).rndesc')" ContinueOnError="true" />
    <Copy SourceFiles="$(TargetDir)$(TargetName)Icon.png" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)$(TargetName)Icon.png')" ContinueOnError="true" />
    <Copy SourceFiles="$(TargetDir)Interop.Renga.dll" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)Interop.Renga.dll')" ContinueOnError="true" />
    <Copy SourceFiles="$(TargetDir)Renga.NET8.PluginUtility.dll" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)Renga.NET8.PluginUtility.dll')" ContinueOnError="true" />
    <Copy SourceFiles="$(TargetDir)Newtonsoft.Json.dll" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)Newtonsoft.Json.dll')" ContinueOnError="true" />
    <Message Text="RengaGH.dll and dependencies copied to $(RengaPluginsPath)" Importance="high" Condition="Exists('$(RengaPluginsPath)\$(TargetName).dll')" />
    <Warning Text="Failed to copy RengaGH.dll to $(RengaPluginsPath). You may need to run as Administrator or copy manually." Condition="!Exists('$(RengaPluginsPath)\$(TargetName).dll')" />
  </Target>
</Project>

